## 빈스톡 타임아웃 이슈
금일 메인 운영 환경에 대해서 특이한 이슈가 발생하였는데 빈스톡으로 구성한 환경의 애플리케이션에 요청이 되지 않는 상황이었다. AWS Elastic Beanstalk에서 지원하는 [관리형 플랫폼 업데이트](https://docs.aws.amazon.com/ko_kr/elasticbeanstalk/latest/dg/environment-platform-update-managed.html)을 일요일에 수행하고나서부터 외부 환경에서 도메인 운영 주소에 대한 헬스 체크가 정상적이지 않았으며 개인적으로 수행하던 모니터링 지표로는 빈스톡 환경 업데이트가 수행된 시점부터 연결 상태가 올바르지 않은 것으로 확인되었다.

#### Caused By
처음에는 무분별한 트래픽 요청에 의해서 나머지 트래픽이 정상적으로 처리되지 않았을 것이라 예상했으나 (자바 애플리케이션에서 CPU 또는 메모리가 높지 않았으나) 오래 걸리는 것 같은 일부 아이피에 대해서 요청되지 않도록 ACL 레벨에서 블락 처리를 수행했으나 동일하게 증상이 남아있었고 빈스톡 환경에서 dig 명령어로 DNS 쿼리 후 전달받은 아이피는 3개 였으나 해당 아이피로 접근하는 포트를 오픈하고 테스트한 결과 응답하지 못하는 상태에 있음을 확인했다.

인프라 엔지니어로부터 VPC에 존재한 일부 서브넷에 대한 NAT 게이트웨이(그때 당시에 사용하지 않았기에 불필요한 비용이라 판단)를 제거한 상태이나 문제가 발생한 빈스톡 환경의 경우에는 로드밸런서와 인스턴스 서브넷에 연결된 것이 ap-northeast-2a, ap-northeast-2b, ap-northeast-2c 영역에 속하였던 것으로 확인되었다. 빈스톡 환경의 로드밸런서에 대한 서브넷을 변경하고자 하였으나 해당 환경은 NLB를 사용하도록 구성한 관계로 서브넷을 제거할 수 없었기에 NAT 게이트웨이가 제거되었던 ap-northeast-2b에 대해서 다시 NAT 게이트웨이를 복원하는 것으로 결정하였다.

#### Solutions
엘라스틱 빈스톡 환경에서 사용중인 로드밸런서 및 인스턴스 서브넷 대역에 대한 NAT 게이트웨이 추가하고나서 트래픽이 정상적으로 애플리케이션까지 도달할 수 있었다. 환경 자동화 업데이트 이전에는 왜 정상적으로 동작했었는지 자세히 알 수 없으나 예상되는 부분은 엘라스틱 빈스톡에 의해 만들어지는 EC2 인스턴스가 NAT 게이트웨이가 제거된 서브넷에 있지 않은 상태였을 것으로 생각된다.