## X509 Certificate Signed by Unknown Authority

2022년 10월 8일 토요일 (KST) 아침에 조직 메일에 특정 고객의 운영 환경에 대해 버전 업그레이드를 시도하다가 사내 젠킨스 서버에 함께 Harbor로 구축해둔 레지스트리 서버에 저장된 서버 이미지를 가져오려다가 위 사유로 급하게 문의를 한 듯 하다.

#### Caused by
도커 허브의 제약사항 및 보안 상의 문제로 인해서 사내 도메인 인증서를 사용하여 프라이빗 레지스트리 서버를 실행하고 있으므로 레지스트리 서버 도메인에 대한 인증서는 신뢰할 수 없는 사설 인증서는 아니다. 하지만, 리눅스 서버 환경에 설치된 도커 엔진에서 레지스트리 서버에 대해 TLS 핸드쉐이크를 수행할 때 도메인을 신뢰할 수 없다고 판단하여 해당 오류를 안내한 것이다.

#### Solutions
1. 리눅스 서버에서 OS 업데이트를 수행하여 루트 CA 인증서 갱신하기
2. 레지스트리 서버에 대한 CA 체인 인증서를 도커 엔진이 참조하는 certs.d 폴더에 등록하기
3. 도커 엔진의 insecure-registry 목록에 레지스트리 서버 도메인 등록하기 (임시조치)

도커 엔진이 레지스트리 서버에 대한 CA 인증서를 참조할 수 있도록 수동으로 등록한다면 추후 레지스트리 서버의 인증서가 만료되는 경우 새로운 인증서로 교체해주어야 한다. 그리고 도커 엔진이 레지스트리 서버를 신뢰할 수 없는 것을 무시하는 방안은 보안 상 좋지 않은 방법이니 긴급하게 대응이 필요한 경우에만 적용해야한다.

