## 레디스 메모리 사용량이 조금씩 증가하는 문제
2022년 11월 29일 화요일 (KST) 일본 고객 측 환경으로부터 레디스가 실행중인 서버의 메모리 사용량이 조금씩 증가하는 패턴으로 모니터링되었다는 문의가 전달되었다.

#### Caused By
토큰 기반 인증의 OAuth API 에서 RequestContextHolder를 통해 스레드 로컬에 저장된 리퀘스트 정보를 가져오기 위해서 ServletRequestAttributes의 getSessionId()를 호출하는 경우 새로운 세션과 함께 세션 아이디가 발급된다. 

레디스 기반의 스프링 세션을 사용중인 경우 스레드 내에서 새로운 세션이 생성됨으로써 해당 세션 데이터를 레디스에 저장하는 문제가 발생한다. 토큰 기반 인증의 경우 레디스에 세션을 저장할 필요가 없는 요청이므로 OAuth API를 호출할 때 마다 불필요하게 레디스에 세션 키가 남아있게 되면서 레디스의 메모리 사용량이 조금씩 증가한다.

#### Solutions
ServletRequestAttributes의 getSessionId()이 아닌 getRequest()를 통해 직접 세션을 조회 후 세션이 없는 요청이라면 토큰 기반 인증으로 간주하고 세션 아이디가 없다고 처리한다. 따라서, 새로운 세션을 생성하지 않으므로 더이상 레디스에 불필요한 데이터가 적재되지 않는다. 
